import { useState } from 'react'
import SiteHeader from './components/SiteHeader'
import SiteFooter from './components/SiteFooter'
import { motion } from 'framer-motion'
import { SocialLinksRail } from './components/SocialLinksRail'
import { useWallet, useConnection } from '@solana/wallet-adapter-react'
import { WalletMultiButton } from '@solana/wallet-adapter-react-ui'
import { Turnstile } from '@marsidev/react-turnstile'
import { Connection, PublicKey, Transaction, SystemProgram, LAMPORTS_PER_SOL } from '@solana/web3.js'

// Cloudflare Turnstile Site Key for Participant Registration
const TURNSTILE_SITE_KEY = '0x4AAAAAACCjOLDn-vMrwViE'

// Red Mugsy Treasury Wallet (Replace with your actual treasury wallet)
const TREASURY_WALLET = 'YourActualTreasuryWalletAddressHere'

type Tier = 'free' | 'pathfinder' | 'keymaster'

type FormErrors = {
  firstName?: string
  lastName?: string
  email?: string
  phone?: string
  wallet?: string
  tier?: string
  payment?: string
  server?: string
  captcha?: string
}

export default function TreasureHuntRegistration() {
  const [showSocialPopup, setShowSocialPopup] = useState(false);
  // Wallet adapter hooks
  const { publicKey, connected, sendTransaction } = useWallet()
  const { connection } = useConnection()()
  const walletAddress = publicKey?.toBase58() || ''

  const [formData, setFormData] = useState({
    firstName: '',
    lastName: '',
    email: '',
    phone: '',
    referralCode: ''
  })
  const [selectedTier, setSelectedTier] = useState<Tier>('free')
  const [errors, setErrors] = useState<FormErrors>({})
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [showSuccess, setShowSuccess] = useState(false)
  const [turnstileToken, setTurnstileToken] = useState<string>('')

  const tierPricing = {
    free: { sol: 0, label: 'Free' },
    pathfinder: { sol: 0.055, label: '0.055 SOL' },
    keymaster: { sol: 0.11, label: '0.11 SOL' }
  }

  const tierHeadStart = {
    free: 'Start when the Hunt officially begins',
    pathfinder: '12-hour head start',
    keymaster: '36-hour head start'
  }

  const getDiscountedPrice = (tier: Tier) => {
    const basePrice = tierPricing[tier].sol
    if (formData.referralCode.trim() && tier !== 'free') {
      return basePrice * 0.75 // 25% discount
    }
    return basePrice
  }

  const validateEmail = (email: string) => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    return emailRegex.test(email)
  }

  const validatePhone = (phone: string) => {
    // Basic phone validation - can be enhanced
    const phoneRegex = /^\+?[\d\s\-()]+$/
    return phoneRegex.test(phone) && phone.replace(/\D/g, '').length >= 10
  }

  const validateForm = (): boolean => {
    const newErrors: FormErrors = {}

    // First Name
    if (!formData.firstName.trim()) {
      newErrors.firstName = 'Please enter your first name.'
    }

    // Last Name
    if (!formData.lastName.trim()) {
      newErrors.lastName = 'Please enter your last name.'
    }

    // Email
    if (!formData.email.trim()) {
      newErrors.email = 'Please enter a valid email address.'
    } else if (!validateEmail(formData.email)) {
      newErrors.email = 'Please enter a valid email address.'
    }

    // Phone
    if (!formData.phone.trim()) {
      newErrors.phone = 'Please enter a valid mobile number.'
    } else if (!validatePhone(formData.phone)) {
      newErrors.phone = 'Please enter a valid mobile number.'
    }

    // Wallet validation for paid tiers
    if (selectedTier !== 'free' && !connected) {
      newErrors.wallet = 'Connect your wallet to continue.'
    }

    // Captcha validation
    if (!turnstileToken) {
      newErrors.captcha = 'Please complete the security verification.'
    }

    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    // Clear previous errors
    setErrors({})

    // Validate form
    if (!validateForm()) {
      return
    }

    setIsSubmitting(true)

    try {
      // Log turnstile token for backend verification
      console.log('===== PARTICIPANT REGISTRATION SUBMISSION =====')
      console.log('Turnstile Token:', turnstileToken)
      console.log('Form Data:', formData)
      console.log('Tier:', selectedTier)
      console.log('Wallet Address:', walletAddress)
      console.log('Note: Token must be verified server-side with secret key')
      console.log('=============================================')

      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 2000))

      // In production: Send to API with turnstile token for verification
      // The backend should verify the token using the secret key before processing
      // Check for duplicate email
      const isDuplicate = false // Replace with actual API check
      if (isDuplicate) {
        setErrors({ email: 'This email is already registered. Try another one.' })
        setIsSubmitting(false)
        return
      }

      // Handle payment for paid tiers
      if (selectedTier !== 'free') {
        // Simulate payment processing
        const paymentSuccess = true // Replace with actual payment logic
        if (!paymentSuccess) {
          setErrors({ payment: 'Your payment didn\'t go through. Try again to secure your spot.' })
          setIsSubmitting(false)
          return
        }
      }

      // Success!
      setShowSuccess(true)
      setIsSubmitting(false)

    } catch (err: any) {
      setIsSubmitting(false)
      if (err.message?.includes('timeout')) {
        setErrors({ server: 'Submission timeout ‚Äî check your connection and resubmit.' })
      } else {
        setErrors({ server: 'Something went wrong on our side. Please try again in a moment.' })
      }
    }
  }

  // Success Screen
  if (showSuccess) {
    return (
      <div className="min-h-screen bg-black text-slate-200 antialiased relative overflow-x-hidden">
        <SocialLinksRail showPopup={showSocialPopup} setShowPopup={setShowSocialPopup} />
        <SiteHeader />

        <main className="relative pt-8 pb-24 sm:pt-12 sm:pb-32 px-6 sm:px-10">
          <div className="max-w-4xl mx-auto">
            <motion.div
              initial={{ opacity: 0, scale: 0.95 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ duration: 0.5 }}
              className="card bg-gradient-to-br from-[#ff1a4b]/20 to-[#00F0FF]/20 border-[#ff1a4b] text-center space-y-8"
            >
              <div className="text-6xl">üî•</div>

              <h1 className="text-4xl sm:text-6xl font-bold text-white">
                Success! You're In.
              </h1>

              <div className="space-y-4 text-lg text-slate-300">
                <p className="text-xl text-white font-semibold">
                  Welcome to the Red Mugsy Treasure Hunt.
                </p>
                <p>
                  Your registration is confirmed, your path is chosen, and your chaos arc officially begins.
                </p>
              </div>

              <div className="card bg-black/40 text-left space-y-6">
                <h2 className="text-2xl font-bold text-white">Here's what happens next:</h2>

                <div>
                  <h3 className="text-lg font-semibold text-[#ff1a4b] mb-2">
                    The Hunt opens based on your tier:
                  </h3>
                  <ul className="space-y-2 text-slate-300">
                      <li className={selectedTier === 'free' ? 'text-white font-semibold' : ''}>
                        ‚Ä¢ <strong>Freeloader:</strong> {tierHeadStart.free}
                      </li>
                    <li className={selectedTier === 'pathfinder' ? 'text-white font-semibold' : ''}>
                      ‚Ä¢ <strong>Pathfinder:</strong> {tierHeadStart.pathfinder}
                    </li>
                    <li className={selectedTier === 'keymaster' ? 'text-white font-semibold' : ''}>
                      ‚Ä¢ <strong>Key Master:</strong> {tierHeadStart.keymaster}
                    </li>
                  </ul>
                </div>

                <div>
                  <h3 className="text-lg font-semibold text-[#00F0FF] mb-2">
                    You'll receive:
                  </h3>
                  <ul className="space-y-2 text-slate-300">
                    <li>‚úì A confirmation email</li>
                    <li>‚úì Your starting clue when your access window opens</li>
                    <li>‚úì Instructions on how to redeem Mugsy Whispers</li>
                    <li>‚úì A personal link to track your progress</li>
                  </ul>
                </div>
              </div>

              <div className="card bg-gradient-to-br from-[#ff1a4b]/10 to-[#00F0FF]/10 border-[#00F0FF]/30 space-y-4">
                <h3 className="text-2xl font-bold text-white">Before You Go</h3>
                <p className="text-slate-300">
                  Join the community so you don't miss updates, hints, or bonus drops:
                </p>
                <div className="flex flex-wrap gap-4 justify-center">
                  <a
                    href="https://t.me/REDMUGSY"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="btn-neo px-6 py-3"
                  >
                    Join Telegram
                  </a>
                  <a
                    href="https://x.com/RedMugsyToken"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="btn-ghost btn-ghost--red px-6 py-3"
                  >
                    Follow on X
                  </a>
                </div>
              </div>

              <div className="pt-6 border-t border-white/10">
                <p className="text-2xl font-bold text-white mb-2">Good Luck, Hunter.</p>
                <p className="text-slate-300">
                  Crack the clues. Break the ciphers.<br />
                  Become a legend in the Mugsy universe.
                </p>
              </div>
            </motion.div>
          </div>
        </main>

        <SiteFooter />
      </div>
    )
  }

  // Registration Form
  return (
    <div className="min-h-screen bg-black text-slate-200 antialiased relative overflow-x-hidden">
      <SocialLinksRail showPopup={showSocialPopup} setShowPopup={setShowSocialPopup} />
      <SiteHeader />

      <main className="relative pt-8 pb-24 sm:pt-12 sm:pb-32 px-6 sm:px-10">
        <div className="max-w-7xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="text-center mb-12"
          >
            <h1 className="text-4xl sm:text-6xl font-bold text-white mb-6">
              Join the Hunt
            </h1>
            <div className="max-w-3xl mx-auto space-y-4">
              <p className="text-3xl text-slate-300">
                Welcome to the doorway of chaos.
              </p>
              <p className="text-lg text-slate-300">
                Pick your path, connect your wallet, and prove you're more than just another chart-sniffing tourist.
              </p>
              <p className="text-3xl text-white font-semibold">
                This is where the Hunt actually begins.
              </p>
              <p className="text-2xl text-slate-400">
                Register below to begin.
              </p>
            </div>
          </motion.div>

          {/* Server Error Alert */}
          {errors.server && (
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              className="max-w-2xl mx-auto mb-6 card bg-red-500/10 border-red-500/30"
            >
              <p className="text-red-400">‚ö†Ô∏è {errors.server}</p>
            </motion.div>
          )}

          {/* Tier Selection Section - Moved Above Form */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
            className="max-w-2xl mx-auto mb-8"
          >
            <div className="card">
              <h2 className="text-3xl font-bold text-white mb-2">Choose Your Path</h2>
              <p className="text-slate-300 mb-6">
                Pick your role in the Hunt.<br />
                More risk, more edge, more power.
              </p>

              {/* Tier Options */}
              <div className="space-y-4">
                {/* Freeloader */}
                <div
                  onClick={() => setSelectedTier('free')}
                  className={`cursor-pointer rounded-lg border-2 p-5 transition ${
                    selectedTier === 'free'
                      ? 'border-[#ff1a4b] bg-[#ff1a4b]/10'
                      : 'border-white/10 hover:border-white/30'
                  }`}
                >
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-3">
                      <span className="text-3xl">ü™´</span>
                      <h3 className="text-xl font-bold text-white">Freeloader</h3>
                    </div>
                    <span className="text-lg font-bold text-[#00F0FF]">Free</span>
                  </div>
                  <p className="text-sm text-slate-400 italic mb-3">
                    For the purists. No crutches. No mercy.
                  </p>
                  <ul className="text-sm text-slate-300 space-y-1">
                    <li>‚Ä¢ 0 Minutes Head Start</li>
                    <li>‚Ä¢ No Mugsy Whispers (no hints)</li>
                    <li>‚Ä¢ 1 Try per clue</li>
                    <li>‚Ä¢ Free entry</li>
                  </ul>
                </div>

                {/* Pathfinder */}
                <div
                  onClick={() => setSelectedTier('pathfinder')}
                  className={`cursor-pointer rounded-lg border-2 p-5 transition ${
                    selectedTier === 'pathfinder'
                      ? 'border-[#ff1a4b] bg-[#ff1a4b]/10'
                      : 'border-white/10 hover:border-white/30'
                  }`}
                >
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-3">
                      <span className="text-3xl">üß≠</span>
                      <h3 className="text-xl font-bold text-white">Pathfinder</h3>
                    </div>
                    <div className="text-right">
                      {formData.referralCode.trim() && (
                        <div className="text-xs text-slate-400 line-through">0.055 SOL</div>
                      )}
                      <span className="text-lg font-bold text-[#00F0FF]">
                        {getDiscountedPrice('pathfinder').toFixed(4)} SOL
                      </span>
                    </div>
                  </div>
                  <p className="text-sm text-slate-400 italic mb-3">
                    For the ones who want an edge, not a cheat code.
                  </p>
                  <ul className="text-sm text-slate-300 space-y-1">
                    <li>‚Ä¢ 12 Hours Head Start on the Hunt</li>
                    <li>‚Ä¢ 3 Mugsy Whispers for the entire Hunt</li>
                    <li>‚Ä¢ 3 Tries per clue</li>
                  </ul>
                </div>

                {/* Key Master */}
                <div
                  onClick={() => setSelectedTier('keymaster')}
                  className={`cursor-pointer rounded-lg border-2 p-5 transition ${
                    selectedTier === 'keymaster'
                      ? 'border-[#ff1a4b] bg-[#ff1a4b]/10'
                      : 'border-white/10 hover:border-white/30'
                  }`}
                >
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-3">
                      <span className="text-3xl">üîë</span>
                      <h3 className="text-xl font-bold text-white">Key Master</h3>
                    </div>
                    <div className="text-right">
                      {formData.referralCode.trim() && (
                        <div className="text-xs text-slate-400 line-through">0.11 SOL</div>
                      )}
                      <span className="text-lg font-bold text-[#00F0FF]">
                        {getDiscountedPrice('keymaster').toFixed(4)} SOL
                      </span>
                    </div>
                  </div>
                  <p className="text-sm text-slate-400 italic mb-3">
                    For the ones who want every possible advantage.
                  </p>
                  <ul className="text-sm text-slate-300 space-y-1">
                    <li>‚Ä¢ 36 Hours Head Start on the Hunt</li>
                    <li>‚Ä¢ 1 Mugsy Whisper per Cipher (10 total)</li>
                    <li>‚Ä¢ Unlimited Tries per clue</li>
                    <li>‚Ä¢ Skip up to 3 clues during the Hunt</li>
                  </ul>
                </div>
              </div>
            </div>
          </motion.div>

          {/* Tier Comparison Table - Separate Section */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.35 }}
            className="max-w-2xl mx-auto mb-8"
          >
            <div className="card">
              <h3 className="text-xl font-bold text-white mb-4">Tier Comparison</h3>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b border-white/10">
                      <th className="text-left py-3 px-2 text-slate-300 font-semibold">Feature</th>
                      <th className="text-center py-3 px-2 text-slate-300 font-semibold">ü™´ Free</th>
                      <th className="text-center py-3 px-2 text-slate-300 font-semibold">üß≠ Path</th>
                      <th className="text-center py-3 px-2 text-slate-300 font-semibold">üîë Master</th>
                    </tr>
                  </thead>
                  <tbody className="text-slate-200">
                    <tr className="border-b border-white/5">
                      <td className="py-3 px-2">Head Start</td>
                      <td className="text-center py-3 px-2">0 min</td>
                      <td className="text-center py-3 px-2">12 hrs</td>
                      <td className="text-center py-3 px-2">36 hrs</td>
                    </tr>
                    <tr className="border-b border-white/5">
                      <td className="py-3 px-2">Mugsy Whispers</td>
                      <td className="text-center py-3 px-2">0</td>
                      <td className="text-center py-3 px-2">3 total</td>
                      <td className="text-center py-3 px-2">1 per cipher</td>
                    </tr>
                    <tr className="border-b border-white/5">
                      <td className="py-3 px-2">Attempts per Clue</td>
                      <td className="text-center py-3 px-2">1</td>
                      <td className="text-center py-3 px-2">3</td>
                      <td className="text-center py-3 px-2">Unlimited</td>
                    </tr>
                    <tr className="border-b border-white/5">
                      <td className="py-3 px-2">Clue Skips</td>
                      <td className="text-center py-3 px-2">None</td>
                      <td className="text-center py-3 px-2">None</td>
                      <td className="text-center py-3 px-2">3 skips</td>
                    </tr>
                    <tr className="border-b border-white/5">
                      <td className="py-3 px-2">Difficulty</td>
                      <td className="text-center py-3 px-2">Brutal</td>
                      <td className="text-center py-3 px-2">Sharp</td>
                      <td className="text-center py-3 px-2">Optimized</td>
                    </tr>
                    <tr>
                      <td className="py-3 px-2 font-semibold">Cost</td>
                      <td className="text-center py-3 px-2 font-bold text-[#00F0FF]">Free</td>
                      <td className="text-center py-3 px-2 font-bold text-[#00F0FF]">0.055 SOL</td>
                      <td className="text-center py-3 px-2 font-bold text-[#00F0FF]">0.11 SOL</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </motion.div>

          {/* Registration Form - Now Single Column */}
          <div>
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4 }}
              className="max-w-2xl mx-auto"
            >
            <form onSubmit={handleSubmit} className="card space-y-6">
              <h2 className="text-2xl font-bold text-white mb-6">Register Here to Join the Hunt</h2>

                <div>
                  <label htmlFor="firstName" className="block text-sm font-medium text-slate-300 mb-2">
                    First Name <span className="text-[#ff1a4b]">*</span>
                  </label>
                  <input
                    id="firstName"
                    type="text"
                    className={`w-full rounded-lg bg-black/50 border px-4 py-3 text-white focus:outline-none ${
                      errors.firstName ? 'border-red-500 focus:border-red-500' : 'border-white/10 focus:border-[#ff1a4b]'
                    }`}
                    value={formData.firstName}
                    onChange={(e) => {
                      setFormData({ ...formData, firstName: e.target.value })
                      setErrors({ ...errors, firstName: undefined })
                    }}
                  />
                  {errors.firstName && (
                    <p className="text-red-400 text-sm mt-1">{errors.firstName}</p>
                  )}
                </div>

                <div>
                  <label htmlFor="lastName" className="block text-sm font-medium text-slate-300 mb-2">
                    Last Name <span className="text-[#ff1a4b]">*</span>
                  </label>
                  <input
                    id="lastName"
                    type="text"
                    className={`w-full rounded-lg bg-black/50 border px-4 py-3 text-white focus:outline-none ${
                      errors.lastName ? 'border-red-500 focus:border-red-500' : 'border-white/10 focus:border-[#ff1a4b]'
                    }`}
                    value={formData.lastName}
                    onChange={(e) => {
                      setFormData({ ...formData, lastName: e.target.value })
                      setErrors({ ...errors, lastName: undefined })
                    }}
                  />
                  {errors.lastName && (
                    <p className="text-red-400 text-sm mt-1">{errors.lastName}</p>
                  )}
                </div>

                <div>
                  <label htmlFor="email" className="block text-sm font-medium text-slate-300 mb-2">
                    Email Address <span className="text-[#ff1a4b]">*</span>
                  </label>
                  <input
                    id="email"
                    type="email"
                    className={`w-full rounded-lg bg-black/50 border px-4 py-3 text-white focus:outline-none ${
                      errors.email ? 'border-red-500 focus:border-red-500' : 'border-white/10 focus:border-[#ff1a4b]'
                    }`}
                    value={formData.email}
                    onChange={(e) => {
                      setFormData({ ...formData, email: e.target.value })
                      setErrors({ ...errors, email: undefined })
                    }}
                  />
                  {errors.email && (
                    <p className="text-red-400 text-sm mt-1">{errors.email}</p>
                  )}
                </div>

                <div>
                  <label htmlFor="phone" className="block text-sm font-medium text-slate-300 mb-2">
                    Mobile Phone Number <span className="text-[#ff1a4b]">*</span>
                  </label>
                  <input
                    id="phone"
                    type="tel"
                    className={`w-full rounded-lg bg-black/50 border px-4 py-3 text-white focus:outline-none ${
                      errors.phone ? 'border-red-500 focus:border-red-500' : 'border-white/10 focus:border-[#ff1a4b]'
                    }`}
                    value={formData.phone}
                    onChange={(e) => {
                      setFormData({ ...formData, phone: e.target.value })
                      setErrors({ ...errors, phone: undefined })
                    }}
                  />
                  {errors.phone && (
                    <p className="text-red-400 text-sm mt-1">{errors.phone}</p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-medium text-slate-300 mb-2">
                    Connect Your Wallet {selectedTier !== 'free' && <span className="text-[#ff1a4b]">*</span>}
                  </label>
                  <p className="text-xs text-slate-400 mb-3">
                    Phantom, Solflare, Backpack, Trust Wallet, or any compatible Solana wallet
                  </p>
                  {connected ? (
                    <div className="space-y-3">
                      <div className="rounded-lg bg-green-900/20 border border-green-500/30 px-4 py-3">
                        <p className="text-green-400 text-sm font-semibold">
                          ‚úì Wallet Connected
                        </p>
                        <p className="text-xs text-slate-400 mt-1 font-mono truncate">
                          {walletAddress}
                        </p>
                      </div>
                      <div className="wallet-adapter-custom">
                        <WalletMultiButton className="w-full !text-sm !py-2" />
                      </div>
                    </div>
                  ) : (
                    <>
                      <div className="wallet-adapter-custom">
                        <WalletMultiButton
                          className={`w-full !rounded-lg !font-semibold ${
                            errors.wallet ? '!ring-2 !ring-red-500' : ''
                          }`}
                        />
                      </div>
                      {errors.wallet && (
                        <p className="text-red-400 text-sm mt-2">{errors.wallet}</p>
                      )}
                    </>
                  )}
                </div>

                <div>
                  <label htmlFor="referralCode" className="block text-sm font-medium text-slate-300 mb-2">
                    Referral Code (Optional)
                  </label>
                  <p className="text-xs text-green-400 mb-2">
                    Enter a referral code for 25% discount on paid tiers
                  </p>
                  <input
                    id="referralCode"
                    type="text"
                    className="w-full rounded-lg bg-black/50 border border-white/10 px-4 py-3 text-white focus:border-[#00F0FF] focus:outline-none uppercase"
                    value={formData.referralCode}
                    onChange={(e) => setFormData({ ...formData, referralCode: e.target.value.toUpperCase() })}
                  />
                </div>

                {errors.payment && (
                  <div className="rounded-lg bg-red-500/10 border border-red-500/30 px-4 py-3">
                    <p className="text-red-400 text-sm">{errors.payment}</p>
                  </div>
                )}

                {/* Cloudflare Turnstile Captcha */}
                <div>
                  <label className="block text-sm font-medium text-slate-300 mb-3">
                    Security Verification <span className="text-[#ff1a4b]">*</span>
                  </label>
                  <div className="flex justify-center">
                    <Turnstile
                      siteKey={TURNSTILE_SITE_KEY}
                      onSuccess={(token: string) => {
                        setTurnstileToken(token)
                        setErrors({ ...errors, captcha: undefined })
                      }}
                      onError={() => {
                        setTurnstileToken('')
                        setErrors({ ...errors, captcha: 'Verification failed. Please try again.' })
                      }}
                      onExpire={() => {
                        setTurnstileToken('')
                        setErrors({ ...errors, captcha: 'Verification expired. Please verify again.' })
                      }}
                    />
                  </div>
                  {errors.captcha && (
                    <p className="text-red-400 text-sm mt-2 text-center">{errors.captcha}</p>
                  )}
                </div>

                <button
                  type="submit"
                  disabled={isSubmitting}
                  className="w-full btn-neo text-lg py-4 mt-6 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {isSubmitting ? 'Submitting...' : 'Submit Registration'}
                </button>
              </form>
            </motion.div>
          </div>
        </div>
      </main>

      <SiteFooter />
    </div>
  )
}

